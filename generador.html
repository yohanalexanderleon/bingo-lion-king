<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ADMINISTRADOR BINGO TOTAL</title>
    <style>
        body { font-family: sans-serif; background: #eee; padding: 20px; display: flex; gap: 20px; }
        .panel { background: white; padding: 20px; width: 50%; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-top: 0; }
        
        /* ESTILOS SORTEO */
        .bola { font-size: 80px; font-weight: bold; color: #c0392b; text-align: center; display: block; margin: 20px 0;}
        .btn-sacar { width: 100%; padding: 20px; background: #e74c3c; color: white; border: none; font-size: 20px; cursor: pointer; border-radius: 5px; }
        .btn-sacar:hover { background: #c0392b; }
        
        /* ESTILOS PAGOS */
        .item-pago { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: #fafafa; border-radius: 5px; }
        .btn-aprob { background: #27ae60; color: white; border: none; padding: 5px 10px; cursor: pointer; margin-right: 5px; }
        .btn-rech { background: #c0392b; color: white; border: none; padding: 5px 10px; cursor: pointer; }
        
        /* GANADOR */
        #zona-ganador { display: none; background: #2ecc71; color: white; padding: 20px; text-align: center; border-radius: 10px; margin-bottom: 20px; animation: parpadeo 1s infinite; }
        .btn-ws { background: white; color: #25D366; text-decoration: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; display: inline-block; margin-top: 10px; }
        @keyframes parpadeo { 0% {opacity: 1;} 50% {opacity: 0.8;} 100% {opacity: 1;} }
    </style>
</head>
<body>

    <div class="panel">
        <h2>üí∞ Gesti√≥n de Pagos</h2>
        <div id="lista-pagos">No hay pagos pendientes...</div>
    </div>

    <div class="panel">
        <div id="zona-ganador">
            <h1>üèÜ ¬°HAY GANADOR!</h1>
            <h2 id="txt-ganador"></h2>
            <a id="link-ws" href="#" target="_blank" class="btn-ws">üì≤ Enviar WhatsApp</a>
        </div>

        <h2>üé± Sorteo</h2>
        <div class="bola" id="bola-actual">--</div>
        <button class="btn-sacar" onclick="sacarBola()">SACAR BOLA</button>
        <div id="historial" style="margin-top:20px; word-wrap: break-word;"></div>
        
        <button onclick="reiniciar()" style="margin-top:30px; background:#333; color:white; border:none; padding:10px;">üî¥ REINICIAR TODO</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // ==========================================
        // 1. PEGA AQU√ç TU CONFIGURACI√ìN DE FIREBASE
        // ==========================================
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_PROYECTO.firebaseapp.com",
            databaseURL: "https://TU_PROYECTO.firebaseio.com",
            projectId: "TU_PROYECTO",
            storageBucket: "TU_PROYECTO.appspot.com",
            messagingSenderId: "123",
            appId: "1:123"
        };

        // ==========================================
        // 2. LISTA DE CARTONES (YA CORREGIDA Y SINCRONIZADA)
        // ==========================================
        const LISTA_CARTONES = [
            [3,7,14,2,4,26,18,29,20,24,36,39,"FREE",43,35,58,46,57,54,51,64,65,61,68,62],
            [9,7,10,13,6,25,22,29,19,24,36,42,"FREE",31,33,52,55,60,48,54,66,64,62,67,63],
            [3,14,4,11,13,21,30,17,26,27,32,39,"FREE",35,41,52,57,47,55,54,73,72,69,66,70],
            [5,8,15,4,3,21,27,30,16,28,44,45,"FREE",42,33,49,47,52,46,48,71,72,75,61,68],
            [11,10,13,8,6,16,25,19,27,18,36,41,"FREE",39,34,56,51,58,48,53,73,65,69,72,63],
            [1,12,15,6,14,26,24,30,16,23,40,36,"FREE",39,44,53,55,47,48,54,71,68,63,61,64],
            [5,14,6,2,4,21,22,29,23,18,34,36,"FREE",37,32,53,56,49,55,52,62,63,74,64,68],
            [13,2,15,4,3,19,24,28,26,18,32,34,"FREE",38,33,51,47,50,52,49,68,64,73,70,69],
            [10,5,12,3,8,18,27,30,26,23,31,37,"FREE",40,35,57,47,60,53,49,67,74,73,68,70],
            [2,7,6,13,4,25,20,24,19,21,32,43,"FREE",33,39,48,54,47,52,59,66,72,70,73,71],
            [4,2,9,14,8,24,23,30,18,22,38,31,"FREE",41,45,50,48,54,52,46,72,74,66,61,70],
            [2,15,12,11,7,28,27,26,29,23,43,41,"FREE",37,36,59,55,52,57,54,61,63,68,71,74],
            [2,14,8,13,5,22,26,21,25,19,38,42,"FREE",35,40,54,50,58,46,49,61,63,70,65,73],
            [14,15,11,9,6,23,22,27,17,21,44,42,"FREE",45,40,51,58,48,47,60,68,63,61,62,65],
            [5,9,2,3,7,24,30,23,22,25,32,42,"FREE",43,31,48,47,56,52,50,67,64,62,61,63],
            [15,8,12,14,5,24,26,22,23,19,32,35,"FREE",43,36,47,53,50,60,56,61,69,66,68,72],
            [6,8,9,10,14,28,18,30,20,21,33,31,"FREE",39,40,57,53,54,58,60,69,75,71,63,61],
            [11,10,6,7,5,29,20,30,28,18,33,32,"FREE",31,44,50,59,58,46,60,71,66,64,69,67],
            [12,5,6,15,4,22,30,20,29,26,41,37,"FREE",32,39,53,55,60,58,56,67,65,62,66,69],
            [7,3,9,6,12,17,16,29,26,21,31,41,"FREE",39,38,47,49,53,46,55,63,71,61,66,62],
            [11,6,8,13,5,29,30,27,22,25,39,36,"FREE",32,33,60,58,57,53,46,75,65,71,72,62],
            [7,8,3,14,6,17,16,20,27,30,44,41,"FREE",35,34,52,60,47,58,46,64,71,74,63,75],
            [3,9,11,1,15,18,29,20,21,22,43,36,"FREE",32,42,51,58,52,60,49,74,67,65,63,72],
            [9,2,5,14,6,18,17,20,25,19,31,38,"FREE",45,40,60,47,51,52,53,70,65,72,67,63],
            [7,2,12,6,11,27,20,25,16,26,40,41,"FREE",45,33,46,56,51,60,50,62,63,71,70,73],
            [7,13,5,2,12,26,17,22,18,27,38,33,"FREE",42,35,51,55,48,47,46,75,70,65,69,72],
            [14,1,12,10,7,18,29,20,16,27,35,34,"FREE",40,45,46,53,60,58,55,63,62,65,70,68],
            [4,12,2,14,3,16,30,19,29,23,37,44,"FREE",40,43,47,52,59,57,50,62,70,63,69,71],
            [13,3,8,11,7,23,27,30,29,16,42,37,"FREE",32,38,46,50,48,56,53,71,73,66,63,74],
            [8,7,5,10,15,23,28,21,16,26,44,42,"FREE",33,40,47,60,53,46,51,68,63,75,71,62],
            [5,13,4,10,6,28,17,26,24,30,36,44,"FREE",31,34,50,51,58,46,53,61,72,68,65,63],
            [10,4,5,11,3,28,16,30,21,22,42,31,"FREE",45,41,46,48,50,60,56,69,64,68,75,72],
            [4,10,13,6,14,29,16,21,18,26,41,36,"FREE",38,39,53,47,57,59,52,63,61,73,62,71],
            [14,11,3,9,7,26,19,22,20,17,42,41,"FREE",38,34,60,48,54,53,55,74,64,72,61,62],
            [15,10,3,14,7,22,21,27,17,23,40,45,"FREE",42,41,52,54,48,50,51,62,71,68,65,64],
            [9,2,3,4,15,27,21,19,22,29,31,35,"FREE",39,42,55,46,58,50,53,67,62,65,68,61],
            [15,2,13,1,10,16,19,17,29,22,44,37,"FREE",43,42,53,52,54,48,56,62,72,63,70,75],
            [14,13,2,7,15,21,24,19,28,22,36,43,"FREE",33,45,59,55,50,52,60,64,73,67,63,72],
            [7,13,5,4,9,16,19,28,30,23,38,40,"FREE",45,34,47,60,52,49,59,70,63,62,75,64],
            [10,1,11,4,3,29,25,20,28,21,32,37,"FREE",44,33,57,50,59,60,53,68,69,63,71,64],
            [13,1,12,15,4,28,24,27,21,30,41,33,"FREE",45,42,57,54,49,50,47,68,62,69,75,73],
            [7,13,3,1,15,16,23,19,24,28,45,40,"FREE",34,33,49,50,46,54,59,66,73,74,62,61],
            [3,2,4,15,6,29,23,27,16,19,39,45,"FREE",38,35,56,57,58,51,49,67,66,62,69,72],
            [2,8,12,3,9,22,25,16,24,26,35,39,"FREE",32,36,60,53,56,55,58,66,71,68,74,65],
            [14,7,10,3,9,23,25,17,27,16,31,40,"FREE",35,43,50,47,60,56,52,70,63,62,72,75],
            [2,9,5,13,15,24,20,30,28,29,35,31,"FREE",40,36,47,54,55,50,56,62,64,72,71,66],
            [15,7,13,10,4,29,26,21,20,19,33,44,"FREE",39,37,57,58,56,54,46,67,65,70,71,75],
            [3,7,6,10,15,24,18,30,21,29,38,39,"FREE",45,41,51,48,56,55,57,73,65,69,75,63],
            [3,10,9,14,12,26,19,16,24,20,44,41,"FREE",40,32,48,57,46,54,56,72,74,61,73,68],
            [2,8,12,10,1,30,26,19,20,28,41,32,"FREE",36,35,55,59,49,48,52,66,64,68,72,73],
            [3,8,7,12,15,17,26,22,16,18,32,39,"FREE",43,38,57,51,52,58,47,70,72,64,73,62],
            [2,5,15,8,9,21,20,17,24,26,43,34,"FREE",35,39,56,46,59,58,54,67,68,64,69,74],
            [11,13,3,9,12,20,22,27,21,19,38,44,"FREE",31,33,52,60,46,59,56,68,61,65,70,64],
            [4,13,8,9,10,18,29,25,23,27,35,45,"FREE",40,42,48,51,57,53,58,63,75,66,70,68],
            [4,7,14,5,9,21,16,28,30,20,32,38,"FREE",40,36,59,60,53,51,50,70,72,68,74,64],
            [10,14,6,7,9,25,21,20,27,23,39,34,"FREE",37,41,55,54,51,48,59,66,61,68,65,71],
            [1,8,12,13,2,25,18,24,21,28,43,36,"FREE",34,40,51,47,59,57,55,71,65,61,69,70],
            [11,2,6,14,7,17,24,16,29,22,42,32,"FREE",37,36,48,55,47,60,53,63,67,72,73,68],
            [1,13,5,11,7,19,24,25,21,16,39,38,"FREE",42,36,47,59,51,54,52,75,66,72,69,65],
            [15,1,3,12,8,25,23,30,18,28,41,40,"FREE",34,33,51,49,53,47,52,62,68,73,61,70],
            [9,3,8,6,7,17,30,25,28,23,33,45,"FREE",40,34,47,60,49,46,54,72,67,63,69,73],
            [10,13,7,3,2,17,29,26,25,18,34,37,"FREE",42,44,47,46,54,56,51,61,73,67,70,66],
            [8,13,4,12,6,20,24,28,30,27,32,44,"FREE",40,41,57,51,53,59,55,69,68,61,75,72],
            [12,10,4,3,15,17,30,24,16,29,44,43,"FREE",37,31,51,56,60,52,55,69,63,67,71,70],
            [14,3,9,7,15,16,23,18,27,30,44,33,"FREE",45,39,57,47,55,52,46,68,74,61,69,66],
            [14,5,12,7,1,19,16,29,26,30,44,39,"FREE",37,36,55,56,57,52,46,62,67,64,61,66],
            [2,10,7,15,3,19,29,20,30,23,34,31,"FREE",39,38,55,46,51,49,52,70,61,66,67,63],
            [9,8,15,10,11,19,30,18,23,29,31,44,"FREE",36,39,52,46,56,54,50,66,73,64,75,62],
            [12,3,11,7,15,18,27,20,26,24,40,44,"FREE",37,39,46,50,59,60,47,72,74,69,75,70],
            [14,8,13,6,9,23,18,25,20,16,34,32,"FREE",33,41,49,58,56,50,51,62,64,65,75,72],
            [1,4,7,12,10,17,21,19,27,25,35,33,"FREE",43,39,48,51,50,49,56,72,61,69,73,66],
            [11,9,15,6,7,29,17,30,23,16,34,40,"FREE",45,44,53,50,49,46,51,71,62,74,67,68],
            [5,4,14,3,8,26,21,20,19,22,33,42,"FREE",40,44,57,53,58,60,50,75,72,67,73,71],
            [2,3,8,9,12,20,16,19,21,28,34,43,"FREE",36,41,52,55,49,57,50,69,74,63,65,66],
            [2,3,8,7,11,20,17,23,29,22,35,38,"FREE",40,32,51,47,50,58,56,70,63,69,71,72],
            [7,10,4,15,6,25,24,28,22,17,34,44,"FREE",35,38,53,56,46,59,55,63,70,74,64,68],
            [7,13,1,12,14,23,19,21,25,24,45,33,"FREE",44,43,51,55,50,52,59,71,67,65,68,75],
            [9,8,6,4,3,20,21,23,30,29,37,35,"FREE",42,34,52,46,51,49,57,61,74,64,63,65],
            [2,12,11,5,6,25,28,26,16,19,32,44,"FREE",42,45,48,50,59,55,57,66,68,69,74,65],
            [13,6,2,12,8,17,25,28,20,29,39,34,"FREE",45,37,48,54,49,57,60,62,70,75,71,67],
            [12,8,11,7,2,26,17,19,18,28,39,31,"FREE",35,34,47,46,58,60,57,64,75,67,63,62],
            [2,14,5,3,9,27,23,25,24,18,39,45,"FREE",33,36,51,57,54,49,55,67,73,75,68,72],
            [1,4,9,3,8,27,29,25,19,16,41,32,"FREE",44,45,51,52,53,60,49,72,62,73,70,75],
            [13,2,15,3,9,30,26,25,27,28,43,45,"FREE",34,39,54,46,51,57,58,75,65,67,63,72],
            [7,9,14,6,2,27,16,26,25,17,45,36,"FREE",34,41,60,53,55,47,51,63,69,70,75,67],
            [8,1,2,10,6,26,28,16,27,23,43,34,"FREE",35,33,47,51,58,52,46,73,64,69,74,75],
            [7,13,5,9,10,28,22,18,19,21,45,39,"FREE",32,43,58,54,60,50,59,71,68,67,73,75],
            [3,13,6,10,2,19,28,16,30,25,45,36,"FREE",42,34,50,54,55,59,47,69,65,73,67,68],
            [8,13,10,7,3,25,16,19,18,23,34,41,"FREE",44,33,56,51,58,49,52,70,72,64,73,65],
            [11,13,12,15,7,24,22,30,19,25,42,36,"FREE",33,37,55,57,60,58,53,61,68,65,70,62],
            [4,3,7,10,9,24,29,17,27,22,40,38,"FREE",34,44,47,49,59,48,53,74,72,64,61,70],
            [1,6,8,5,14,16,30,18,24,23,34,44,"FREE",31,33,54,57,58,55,50,73,74,67,62,66],
            [1,15,10,12,2,27,20,26,23,17,44,41,"FREE",37,32,49,59,52,58,47,61,72,73,62,65],
            [15,10,13,14,1,20,27,24,29,21,34,39,"FREE",40,31,59,57,56,54,58,71,74,70,67,65],
            [13,4,7,8,6,22,29,20,23,21,42,31,"FREE",41,34,47,48,49,57,55,66,75,67,63,74],
            [2,5,11,6,13,19,25,21,26,18,42,45,"FREE",44,40,47,56,58,48,49,62,71,61,73,72],
            [1,5,6,8,4,24,21,20,22,16,34,31,"FREE",40,44,47,48,52,51,60,68,66,69,62,61],
            [9,7,5,15,2,26,22,25,21,18,39,35,"FREE",31,32,53,51,55,60,46,61,73,70,69,66],
            [7,10,5,3,11,16,18,21,19,25,45,31,"FREE",44,38,48,49,52,57,60,73,67,64,66,68],
            [2,8,6,4,3,21,22,19,26,29,31,32,"FREE",36,44,55,47,51,59,50,73,75,62,70,71]
        ];

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const miID = localStorage.getItem('bingo_uid') || Math.random().toString(36).substr(2,9);
        localStorage.setItem('bingo_uid', miID);
        let cartonTemp = null;

        // DIBUJAR 100 BOTONES
        const cont = document.getElementById('contenedor-botones');
        for(let i=0; i<100; i++){
            let b = document.createElement('button');
            b.id = `btn-${i}`;
            b.innerText = i+1;
            b.className = 'btn-carton libre';
            b.onclick = () => abrirModal(i);
            cont.appendChild(b);
        }

        // ESCUCHAR ESTADOS
        onValue(ref(db, 'bingo/estados'), (snap) => {
            const data = snap.val() || {};
            for(let i=0; i<100; i++){
                const info = data[i];
                const btn = document.getElementById(`btn-${i}`);
                if(!info){
                    btn.className = 'btn-carton libre'; btn.disabled=false; btn.innerText=i+1;
                } else {
                    if(info.uid === miID){
                        // ES M√çO
                        btn.className = 'btn-carton mio';
                        btn.innerText = (info.status==='pagado') ? "JUGAR" : "REVISI√ìN";
                        btn.onclick = () => entrarJuego(i, info.status);
                        // Auto-entrar si estoy jugando y aprobaron
                        const pantallaJuego = document.getElementById('pantalla-juego');
                        if(pantallaJuego.style.display==='block' && info.status==='pagado'){
                            document.getElementById('estado-pago').style.display='none';
                            escucharBolas();
                        }
                    } else {
                        // ES DE OTRO
                        btn.className = (info.status==='pagado') ? 'btn-carton ocupado' : 'btn-carton revision';
                        btn.innerText = (info.status==='pagado') ? "üîí" : "‚è≥";
                        btn.disabled = true;
                    }
                }
            }
        });

        // FUNCIONES DE PAGO
        window.abrirModal = (i) => {
            cartonTemp = i;
            document.getElementById('lbl-carton').innerText = i+1;
            document.getElementById('modal-pago').style.display = 'flex';
        }

        window.enviarPago = () => {
            const nom = document.getElementById('inp-nombre').value;
            const tel = document.getElementById('inp-telf').value;
            const refNum = document.getElementById('inp-ref').value;

            if(!nom || !tel || !refNum) return alert("Llena todos los datos");

            set(ref(db, `bingo/estados/${cartonTemp}`), {
                uid: miID, nombre: nom, telefono: tel, referencia: refNum, status: 'revision', carton_id: cartonTemp
            });
            document.getElementById('modal-pago').style.display='none';
            alert("Datos enviados. Espera aprobaci√≥n.");
        }

        window.entrarJuego = (i, status) => {
            document.getElementById('pantalla-seleccion').style.display='none';
            document.getElementById('pantalla-juego').style.display='block';
            document.getElementById('lbl-num-juego').innerText = i+1;
            
            const grid = document.getElementById('carton');
            grid.innerHTML = "";
            ['B','I','N','G','O'].forEach(l=>grid.innerHTML+=`<div class="header">${l}</div>`);
            
            LISTA_CARTONES[i].forEach(n => {
                let d = document.createElement('div');
                d.className = 'celda';
                d.innerText = (n==="FREE")?"‚òÖ":n;
                d.id = (n==="FREE")?"free":`num-${n}`;
                if(n==="FREE") d.classList.add('marcada');
                grid.appendChild(d);
            });

            if(status==='pagado') {
                document.getElementById('estado-pago').style.display='none';
                escucharBolas();
            }
        };

        function escucharBolas() {
            onValue(ref(db, 'bingo/historial'), (snap) => {
                const bolas = snap.val();
                if(!bolas) return;
                Object.values(bolas).forEach(n => {
                    let c = document.getElementById(`num-${n}`);
                    if(c) c.classList.add('marcada');
                });
            });
            // Escuchar si gan√©
            onValue(ref(db, 'bingo/ganador'), (snap) => {
                if(snap.val() && snap.val().uid === miID) {
                    document.getElementById('aviso-gane').style.display = 'block';
                    navigator.vibrate([500, 200, 500]);
                }
            });
        }
    </script>
</body>
</html>